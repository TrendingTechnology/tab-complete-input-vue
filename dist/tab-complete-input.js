var t=function(t){for(var o in this.options={maxCache:10,enableCache:!0,insertOrder:!1,returnRoot:!1,insert:null,sort:null,clip:null,copy:null,merge:null},this.root={},this.index=0,t)t.hasOwnProperty(o)&&(this.options[o]=t[o]);"function"!=typeof this.options.insert&&(this.options.insert=function(t,o){return this.options.insertOrder&&void 0===o.d&&void 0===o.o&&(o={d:o,o:this.index++}),t&&t.length?t.push(o):t=[o],t}),"function"!=typeof this.options.sort&&(this.options.insertOrder?this.options.insertOrder&&(this.options.sort=function(){this.sort(function(t,o){return t.o-o.o})}):this.options.sort=function(){this.sort()}),"function"!=typeof this.options.clip&&(this.options.clip=function(t){this.length>t&&this.splice(t,this.length-t)}),"function"!=typeof this.options.copy&&(this.options.copy=function(t){return t.slice(0)}),"function"!=typeof this.options.merge&&(this.options.merge=function(t,o,e){for(var i=0,s=o.length;i<s;i++)t=this.options.insert.call(this,t,o[i]),this.options.sort.call(t,e),this.options.clip.call(t,this.options.maxCache);return t})};t.prototype._addCacheData=function(t,o){return!(this.root===t&&!this.options.returnRoot||!1===this.options.enableCache)&&(t.$d||(t.$d={}),t.$d=this.options.insert.call(this,t.$d,o),this.options.sort.call(t.$d),this.options.clip.call(t.$d,this.options.maxCache),!0)},t.prototype._addSuffix=function(t,o,e){var i=t.charAt(0),s=t.substring(1)||null,n={$d:{}};s&&(n.$s=s),void 0===e[i]?e[i]=n:void 0===e[i].$d&&(e[i].$d={},s&&void 0===e[i].$s&&(e[i].$s=s)),e[i].$d=this.options.insert.call(this,e[i].$d,o),this.options.sort.call(e[i].$d)},t.prototype._moveSuffix=function(t,o,e){var i=t.charAt(0),s=t.substring(1)||null,n={$d:{}};s&&(n.$s=s),void 0===e[i]&&(e[i]=n),e[i].$d=this.options.copy(o)},t.prototype._getDataAtNode=function(t,o){var e;return this.options.enableCache?(this.options.sort.call(t.$d,o),e=t.$d):e=this._getSubtree(t,o),this.options.insertOrder&&(e=this._stripInsertOrder(e)),e?this.options.copy(e):void 0},t.prototype._stripInsertOrder=function(t){if(void 0!==t){for(var o=[],e=0,i=t.length;e<i;e++)o.push(t[e].d);return o}},t.prototype._getSubtree=function(t,o){for(var e,i,s=[t];i=s.pop();)for(var n in i)i.hasOwnProperty(n)&&("$d"==n?(void 0===e&&(e=[]),e=this.options.merge.call(this,e,i.$d,o)):"$s"!=n&&s.push(i[n]));return e},t.prototype.add=function(t,o){if("string"!=typeof t)return!1;1==arguments.length&&(o=t),t=t.toLowerCase();for(var e=this.root,i=0,s=t.length;i<s;i++){var n=t.charAt(i);if(e[n])i==s-1?(this._addCacheData(e,o),this._addCacheData(e[n],o)||this._addSuffix(n,o,e)):(this._addCacheData(e,o),e=e[n]);else{if(e.$s){if(e.$s==t.substring(i)){this._addCacheData(e,o)||(e.$d=this.options.insert.call(this,e.$d,o),this.options.sort.call(e.$d));break}this._moveSuffix(e.$s,e.$d,e),delete e.$s,!1===this.options.enableCache&&delete e.$d}if(!e[n]){this._addSuffix(t.substring(i),o,e),this._addCacheData(e,o);break}this._addCacheData(e,o),i==s-1&&(e[n].$s?(this._moveSuffix(e[n].$s,e[n].$d,e[n]),delete e[n].$s,!1===this.options.enableCache&&delete e[n].$d,this._addSuffix(n,o,e)):this._addCacheData(e[n],o)||this._addSuffix(n,o,e)),e=e[n]}}},t.prototype.remove=function(t){if("string"==typeof t&&""!==t&&!this.options.enableCache){var o,e,i;t=t.toLowerCase();var s,n,r,a=this.root,d=0;for(e=0,i=t.length;e<i;e++){if(!a[o=t.charAt(e)]){if(a.$s&&a.$s===t.substring(e))break;return}s=a,n=o,a=a[o]}for(var l in r=this.options.copy(a.$d),this.options.insertOrder&&(r=this._stripInsertOrder(r)),delete a.$d,delete a.$s,a)a.hasOwnProperty(l)&&d++;return d||delete s[n],r}},t.prototype.contains=function(t){if("string"!=typeof t||""==t)return!1;t=t.toLowerCase();for(var o=this.root,e=0,i=t.length;e<i;e++){var s=t.charAt(e);if(!o[s])return!(!o.$s||o.$s!==t.substring(e));o=o[s]}return!(!o.$d||void 0!==o.$s)},t.prototype.find=function(t){if("string"==typeof t&&(""!=t||this.options.returnRoot)){t=t.toLowerCase();for(var o=this.root,e=0,i=t.length;e<i;e++){var s=t.charAt(e);if(!o[s])return o.$s&&0==o.$s.indexOf(t.substring(e))?this._getDataAtNode(o,t):void 0;o=o[s]}return this._getDataAtNode(o,t)}};var o={name:"tab-complete-input",data:function(){return{trie:{},position:0,wordPos:0,index:0,words:[],word:"",dynamicData:!1,possible:!1,saved:!1,localValue:this.value}},render:function(t){var o=this;return t("input",{ref:"input",attrs:Object.assign({},o.$props),domProps:{value:o.value},directives:[{name:"model",rawName:"v-model",value:o.localValue,expression:"value"}],on:Object.assign({},o.$listeners,{keydown:o.$listeners.keydown?[o.tabComplete,o.$listeners.keydown]:o.tabComplete,input:function(t){o.localValue=t.target.value,o.$emit("input",t.target.value)}})})},created:function(){this.dynamicData=this.dataSource instanceof Function,this.dynamicData||this.setData(this.dataSource)},props:{dataSource:{default:function(){return[]}},format:{default:function(t,o,e){return{word:t,prev:o}},type:Function},value:{default:"",type:String}},watch:{dataSource:function(t){this.dynamicData=t instanceof Function,this.dynamicData||this.setData(t)}},methods:{setData:function(o){var e=this;this.trie=new t,o.forEach(function(t){e.trie.add(t)})},tabComplete:function(t){try{var o=this;function e(){if(o.possible&&o.index>=o.possible.length&&(o.index=0),o.possible){t&&t.preventDefault();var e=o.words,i="";e.length>1&&(i=e[o.wordPos-1]);var s=o.format(o.possible[o.index],i,o.wordPos);e[o.wordPos]=s.word,s.prev&&(e[o.wordPos-1]=s.prev);var n=o.words.slice(0,o.wordPos+1).join(" ").length;o.localValue=e.join(" "),o.localValue=o.localValue.slice(0,n)+o.localValue.slice(n+1),o.updateValue(o.localValue),o.selectRange(n,n)}}if(t&&9!==t.keyCode)return o.saved=!1,o.index=0,Promise.resolve();var i=function(){if(!o.saved){function e(){o.saved=!0,o.possible=o.trie.find(o.word)}o.position=o.getCursorPos();var i=o.localValue.slice(0,o.position)+" "+o.localValue.slice(o.position);o.words=i.split(" ");for(var s=0,n=0;n<o.words.length;n++){if((s+=o.words[n].length+1)>=o.position){o.word=o.words[n],o.wordPos=n;break}}""!=o.word&&t&&t.preventDefault();var r=function(){if(o.dynamicData){var t=o.dataSource(o.word,o.wordPos);return Promise.resolve(t).then(function(t){o.setData(t)})}}();return r&&r.then?r.then(e):e()}o.index++}();return Promise.resolve(i&&i.then?i.then(e):e())}catch(t){return Promise.reject(t)}},updateValue:function(t){this.localValue=t,this.$emit("input",t)},selectRange:function(t,o){this.$el.focus(),this.$el.setSelectionRange(t,o)},getCursorPos:function(){return this.$el.selectionStart}}};module.exports=o;
//# sourceMappingURL=tab-complete-input.js.map
