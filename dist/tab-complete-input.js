var t,e=(t=require("vue"))&&"object"==typeof t&&"default"in t?t.default:t;function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t}).apply(this,arguments)}var i={enableCache:!0,insertOrder:!1,returnRoot:!1},n=function(){function t(t){var e=this;for(var o in this.options=i,this.root={},this.index=0,t)t.hasOwnProperty(o)&&(this.options[o]=t[o]);"function"!=typeof this.options.insert&&(this.options.insert=function(t,o){return e.options.insertOrder&&!(void 0!==(i=o).d&&void 0!==i.o)&&e.index++,t&&t.length?t.push(o):t=[o],t;var i}),"function"!=typeof this.options.sort&&(this.options.insertOrder?this.options.insertOrder&&(this.options.sort=function(){this.sort(function(t,e){return void 0===t.o||void 0===e.o?0:t.o-e.o})}):this.options.sort=function(){this.sort()}),"function"!=typeof this.options.clip&&(this.options.clip=function(t){this.length>t&&this.splice(t,this.length-t)}),"function"!=typeof this.options.copy&&(this.options.copy=function(t){return t.slice(0)}),"function"!=typeof this.options.merge&&(this.options.merge=function(t,o,i){for(var n=0,s=o.length;n<s;n++)t=e.options.insert.call(e,t,o[n]),e.options.sort.call(t,i);return t})}var e=t.prototype;return e._addCacheData=function(t,e){return!(this.root===t&&!this.options.returnRoot||!1===this.options.enableCache||(t.$d||(t.$d={}),t.$d=this.options.insert.call(this,t.$d,e),this.options.sort.call(t.$d),0))},e._addSuffix=function(t,e,o){var i=t.charAt(0),n=t.substring(1)||null,s={$d:{}};n&&(s.$s=n),void 0===o[i]?o[i]=s:void 0===o[i].$d&&(o[i].$d={},n&&void 0===o[i].$s&&(o[i].$s=n)),o[i].$d=this.options.insert.call(this,o[i].$d,e),this.options.sort.call(o[i].$d)},e._moveSuffix=function(t,e,o){var i=t.charAt(0),n=t.substring(1)||null,s={$d:{}};n&&(s.$s=n),void 0===o[i]&&(o[i]=s),o[i].$d=this.options.copy(e)},e._getDataAtNode=function(t,e){var o;return this.options.enableCache?(this.options.sort.call(t.$d,e),o=t.$d):o=this._getSubtree(t,e),this.options.insertOrder&&(o=this._stripInsertOrder(o)),o?this.options.copy(o):void 0},e._stripInsertOrder=function(t){if(void 0!==t){for(var e=[],o=0,i=t.length;o<i;o++)e.push(t[o].d);return e}},e._getSubtree=function(t,e){for(var o,i=[],n=[t];o=n.pop();)for(var s in o)o.hasOwnProperty(s)&&("$d"==s?i=this.options.merge.call(this,i,o.$d,e):"$s"!=s&&n.push(o[s]));return i},e.add=function(t,e){if("string"!=typeof t)return!1;1==arguments.length&&(e=t),t=t.toLowerCase();for(var o=this.root,i=0,n=t.length;i<n;i++){var s=t.charAt(i);if(o[s])i==n-1?(this._addCacheData(o,e),this._addCacheData(o[s],e)||this._addSuffix(s,e,o)):(this._addCacheData(o,e),o=o[s]);else{if(o.$s){if(o.$s==t.substring(i)){this._addCacheData(o,e)||(o.$d=this.options.insert.call(this,o.$d,e),this.options.sort.call(o.$d));break}this._moveSuffix(o.$s,o.$d,o),delete o.$s,!1===this.options.enableCache&&delete o.$d}if(!o[s]){this._addSuffix(t.substring(i),e,o),this._addCacheData(o,e);break}this._addCacheData(o,e),i==n-1&&(o[s].$s?(this._moveSuffix(o[s].$s,o[s].$d,o[s]),delete o[s].$s,!1===this.options.enableCache&&delete o[s].$d,this._addSuffix(s,e,o)):this._addCacheData(o[s],e)||this._addSuffix(s,e,o)),o=o[s]}}},e.contains=function(t){if("string"!=typeof t||""==t)return!1;t=t.toLowerCase();for(var e=this.root,o=0,i=t.length;o<i;o++){var n=t.charAt(o);if(!e[n])return!(!e.$s||e.$s!==t.substring(o));e=e[n]}return!(!e.$d||void 0!==e.$s)},e.find=function(t){if("string"==typeof t&&(""!=t||this.options.returnRoot)){t=t.toLowerCase();for(var e=this.root,o=0,i=t.length;o<i;o++){var n=t.charAt(o);if(!e[n])return e.$s&&0==e.$s.indexOf(t.substring(o))?this._getDataAtNode(e,t):void 0;e=e[n]}return this._getDataAtNode(e,t)}},t}(),s=e.extend({name:"tab-complete-input",data:function(){return{trie:new n,position:0,wordPos:0,index:0,words:[],word:"",dynamicData:!1,possible:!1,saved:!1,localValue:this.value}},render:function(t){var e=this,i=e.$listeners.keydown?[e.tabComplete,e.$listeners.keydown]:e.tabComplete;return t("input",{ref:"input",attrs:o({},e.$props),domProps:{value:e.value},directives:[{name:"model",value:e.localValue,expression:"value"}],on:o({},e.$listeners,{keydown:i,input:function(t){e.localValue=t.target.value,e.$emit("input",t.target.value)}})})},created:function(){this.dynamicData=this.dataSource instanceof Function,this.dynamicData||this.setData(this.dataSource)},props:{dataSource:{default:function(){return[]}},format:{default:function(t,e,o){return{word:t,prev:e}},type:Function},value:{default:"",type:String}},watch:{dataSource:function(t){this.dynamicData=t instanceof Function,this.dynamicData||this.setData(t)}},methods:{setData:function(t){var e=this;this.trie=new n,t.forEach(function(t){e.trie.add(t)})},tabComplete:function(t){try{var e=function(){if(o.possible&&o.index>=o.possible.length&&(o.index=0),o.possible){t&&t.preventDefault();var e=o.words,i="";e.length>1&&(i=e[o.wordPos-1]);var n=o.format(o.possible[o.index],i,o.wordPos);e[o.wordPos]=n.word,n.prev&&(e[o.wordPos-1]=n.prev);var s=o.words.slice(0,o.wordPos+1).join(" ").length;o.localValue=e.join(" "),o.localValue=o.localValue.slice(0,s)+o.localValue.slice(s+1),o.updateValue(o.localValue),o.$nextTick(function(){return o.selectRange(s,s)})}},o=this;if(t&&9!==t.keyCode)return o.saved=!1,o.index=0,Promise.resolve();var i=function(){if(!o.saved){var e=function(){o.saved=!0,o.possible=o.trie.find(o.word)};o.position=o.getCursorPos();var i=o.localValue.slice(0,o.position)+" "+o.localValue.slice(o.position);o.words=i.split(" ");for(var n=0,s=0;s<o.words.length;s++)if((n+=o.words[s].length+1)>=o.position)return o.word=o.words[s],void(o.wordPos=s);""!=o.word&&t&&t.preventDefault();var r=function(){if(o.dynamicData){var t=o.dataSource(o.word,o.wordPos);return Promise.resolve(t).then(function(t){o.setData(t)})}}();return r&&r.then?r.then(e):e()}o.index++}();return Promise.resolve(i&&i.then?i.then(e):e())}catch(t){return Promise.reject(t)}},updateValue:function(t){this.localValue=t,this.$emit("input",t)},selectRange:function(t,e){this.$el.focus(),this.$el.setSelectionRange(t,e)},getCursorPos:function(){return this.$el.selectionStart}}});module.exports=s;
//# sourceMappingURL=tab-complete-input.js.map
