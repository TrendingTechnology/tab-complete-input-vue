import t from"vue";function o(){return(o=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t}).apply(this,arguments)}var e={enableCache:!0,insertOrder:!1,returnRoot:!1},i=function(){function t(t){var o=this;for(var i in this.options=e,this.root={},this.index=0,t)t.hasOwnProperty(i)&&(this.options[i]=t[i]);"function"!=typeof this.options.insert&&(this.options.insert=function(t,e){return o.options.insertOrder&&!(void 0!==(i=e).d&&void 0!==i.o)&&o.index++,t&&t.length?t.push(e):t=[e],t;var i}),"function"!=typeof this.options.sort&&(this.options.insertOrder?this.options.insertOrder&&(this.options.sort=function(){this.sort(function(t,o){return void 0===t.o||void 0===o.o?0:t.o-o.o})}):this.options.sort=function(){this.sort()}),"function"!=typeof this.options.clip&&(this.options.clip=function(t){this.length>t&&this.splice(t,this.length-t)}),"function"!=typeof this.options.copy&&(this.options.copy=function(t){return t.slice(0)}),"function"!=typeof this.options.merge&&(this.options.merge=function(t,e,i){for(var n=0,s=e.length;n<s;n++)t=o.options.insert.call(o,t,e[n]),o.options.sort.call(t,i);return t})}var o=t.prototype;return o._addCacheData=function(t,o){return!(this.root===t&&!this.options.returnRoot||!1===this.options.enableCache||(t.$d||(t.$d={}),t.$d=this.options.insert.call(this,t.$d,o),this.options.sort.call(t.$d),0))},o._addSuffix=function(t,o,e){var i=t.charAt(0),n=t.substring(1)||null,s={$d:{}};n&&(s.$s=n),void 0===e[i]?e[i]=s:void 0===e[i].$d&&(e[i].$d={},n&&void 0===e[i].$s&&(e[i].$s=n)),e[i].$d=this.options.insert.call(this,e[i].$d,o),this.options.sort.call(e[i].$d)},o._moveSuffix=function(t,o,e){var i=t.charAt(0),n=t.substring(1)||null,s={$d:{}};n&&(s.$s=n),void 0===e[i]&&(e[i]=s),e[i].$d=this.options.copy(o)},o._getDataAtNode=function(t,o){var e;return this.options.enableCache?(this.options.sort.call(t.$d,o),e=t.$d):e=this._getSubtree(t,o),this.options.insertOrder&&(e=this._stripInsertOrder(e)),e?this.options.copy(e):void 0},o._stripInsertOrder=function(t){if(void 0!==t){for(var o=[],e=0,i=t.length;e<i;e++)o.push(t[e].d);return o}},o._getSubtree=function(t,o){for(var e,i=[],n=[t];e=n.pop();)for(var s in e)e.hasOwnProperty(s)&&("$d"==s?i=this.options.merge.call(this,i,e.$d,o):"$s"!=s&&n.push(e[s]));return i},o.add=function(t,o){if("string"!=typeof t)return!1;1==arguments.length&&(o=t),t=t.toLowerCase();for(var e=this.root,i=0,n=t.length;i<n;i++){var s=t.charAt(i);if(e[s])i==n-1?(this._addCacheData(e,o),this._addCacheData(e[s],o)||this._addSuffix(s,o,e)):(this._addCacheData(e,o),e=e[s]);else{if(e.$s){if(e.$s==t.substring(i)){this._addCacheData(e,o)||(e.$d=this.options.insert.call(this,e.$d,o),this.options.sort.call(e.$d));break}this._moveSuffix(e.$s,e.$d,e),delete e.$s,!1===this.options.enableCache&&delete e.$d}if(!e[s]){this._addSuffix(t.substring(i),o,e),this._addCacheData(e,o);break}this._addCacheData(e,o),i==n-1&&(e[s].$s?(this._moveSuffix(e[s].$s,e[s].$d,e[s]),delete e[s].$s,!1===this.options.enableCache&&delete e[s].$d,this._addSuffix(s,o,e)):this._addCacheData(e[s],o)||this._addSuffix(s,o,e)),e=e[s]}}},o.contains=function(t){if("string"!=typeof t||""==t)return!1;t=t.toLowerCase();for(var o=this.root,e=0,i=t.length;e<i;e++){var n=t.charAt(e);if(!o[n])return!(!o.$s||o.$s!==t.substring(e));o=o[n]}return!(!o.$d||void 0!==o.$s)},o.find=function(t){if("string"==typeof t&&(""!=t||this.options.returnRoot)){t=t.toLowerCase();for(var o=this.root,e=0,i=t.length;e<i;e++){var n=t.charAt(e);if(!o[n])return o.$s&&0==o.$s.indexOf(t.substring(e))?this._getDataAtNode(o,t):void 0;o=o[n]}return this._getDataAtNode(o,t)}},t}(),n=t.extend({name:"tab-complete-input",data:function(){return{trie:new i,position:0,wordPos:0,index:0,words:[],word:"",dynamicData:!1,possible:!1,saved:!1,localValue:this.value}},render:function(t){var e=this,i=e.$listeners.keydown?[e.tabComplete,e.$listeners.keydown]:e.tabComplete;return t("input",{ref:"input",attrs:o({},e.$props),domProps:{value:e.value},directives:[{name:"model",value:e.localValue,expression:"value"}],on:o({},e.$listeners,{keydown:i,input:function(t){e.localValue=t.target.value,e.$emit("input",t.target.value)}})})},created:function(){this.dynamicData=this.dataSource instanceof Function,this.dynamicData||this.setData(this.dataSource)},props:{dataSource:{default:function(){return[]}},format:{default:function(t,o,e){return{word:t,prev:o}},type:Function},value:{default:"",type:String}},watch:{dataSource:function(t){this.dynamicData=t instanceof Function,this.dynamicData||this.setData(t)}},methods:{setData:function(t){var o=this;this.trie=new i,t.forEach(function(t){o.trie.add(t)})},tabComplete:function(t){try{var o=function(){if(e.possible&&e.index>=e.possible.length&&(e.index=0),e.possible){t&&t.preventDefault();var o=e.words,i="";o.length>1&&(i=o[e.wordPos-1]);var n=e.format(e.possible[e.index],i,e.wordPos);o[e.wordPos]=n.word,n.prev&&(o[e.wordPos-1]=n.prev);var s=e.words.slice(0,e.wordPos+1).join(" ").length;e.localValue=o.join(" "),e.localValue=e.localValue.slice(0,s)+e.localValue.slice(s+1),e.updateValue(e.localValue),e.$nextTick(function(){return e.selectRange(s,s)})}},e=this;if(t&&9!==t.keyCode)return e.saved=!1,e.index=0,Promise.resolve();var i=function(){if(!e.saved){var o=function(){e.saved=!0,e.possible=e.trie.find(e.word)};e.position=e.getCursorPos();var i=e.localValue.slice(0,e.position)+" "+e.localValue.slice(e.position);e.words=i.split(" ");for(var n=0,s=0;s<e.words.length;s++)if((n+=e.words[s].length+1)>=e.position)return e.word=e.words[s],void(e.wordPos=s);""!=e.word&&t&&t.preventDefault();var r=function(){if(e.dynamicData){var t=e.dataSource(e.word,e.wordPos);return Promise.resolve(t).then(function(t){e.setData(t)})}}();return r&&r.then?r.then(o):o()}e.index++}();return Promise.resolve(i&&i.then?i.then(o):o())}catch(t){return Promise.reject(t)}},updateValue:function(t){this.localValue=t,this.$emit("input",t)},selectRange:function(t,o){this.$el.focus(),this.$el.setSelectionRange(t,o)},getCursorPos:function(){return this.$el.selectionStart}}});export default n;
//# sourceMappingURL=tab-complete-input.mjs.map
